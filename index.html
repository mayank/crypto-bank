<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="bootstrap.min.css">
		<meta content='width=device-width,initial-scale=1.0' name='viewport'>
	</head>
	<body>
		<div class="row-fluid">
			<div class="col-md-5 col-sm-12">
				<table class="table text-center">
					<thead>
						<tr class="info">
							<th>Currency</th>
							<th>Sell Price</th>
							<th>Wallet</th>
							<th>Bitcoin Value</th>
						</tr>
					</thead>
					<tbody id="list">
							<tr>
								<td colspan="2"></td>
								<td><span id="totalpost"></span></td>
								<td><span id="totalpre"></span> BTC</td>
							</tr>
					</tbody>
				</table>
			</div>
		</div>
		<script src="jquery.min.js"></script>
		<script>
				var portfolio = [
					{
							"currency": "ETC",
							"balance": "14.25714286"
					},
					{
							"currency": "ETH",
							"balance": "2.50687989"
					},
					{
							"currency": "LTC",
							"balance": "9.15596343"
					},
					{
							"currency": "MCAP",
							"balance": "49.90000019"
					},
					{
							"currency": "MIOTA",
							"balance": "94.78"
					}
				];
				var coinAPI = [];
				$(document).ready(function(){
						hitTheMarket();
				});
				
				function hitTheMarket(){
					$.get('https://api.coinmarketcap.com/v1/ticker/', function(result){
						coinAPI = result;
						startFetchingData();
						setTimeout(hitTheMarket, 3000);
					});
				}
				
				function startFetchingData(){
						var walletBalance = 0;
						portfolio.forEach(function(wallet){
								coinAPI.forEach(function(coin){
										if(coin.symbol == wallet.currency){
												walletBalance += parseFloat(setTheTuple(coin, wallet));
										}
								});
						});
					 	$('#totalpre').html(walletBalance.toFixed(5));
						$('#totalpost').attr('data-balance', walletBalance).addClass('totalpost');
						
						$.get('https://api.zebpay.com/api/v1/ticker?currencyCode=INR', function(result){
								$('.totalpost').each(function(){
										var balance = parseFloat($(this).attr('data-balance'));
										$(this).html('Rs.'+Math.floor(balance*parseFloat(result.sell)));
								});
						});
				}
				
				function setTheTuple(coin, wallet){
						var walletBalance = (parseFloat(wallet.balance) * parseFloat(coin.price_btc)).toFixed(5);
						var elem = $('#list').children('#'+coin.id);
						var html = '<tr id="' + coin.id + '">' + 
													'<td>' + coin.name + '</td>' + 
													'<td>' +
														'<p>' + coin.price_btc + '</p>' + 
														'<p class="small">' + coin.price_usd + ' USD</p>' + 
													'</td>' + 
													'<td>' + wallet.balance + '</td>' + 
													'<td>' + 
														'<p>' + walletBalance + '</p>' + 
														'<p class="small totalpost" data-balance="' + walletBalance + '"></p>' + 
													'</td>' + 
												'</tr>';
						if(elem.length > 0){
								$(elem).replaceWith(html);
						} else {
								$('#list').prepend(html);
						}
						return walletBalance;
				}
		</script>
	</body>
</html>
